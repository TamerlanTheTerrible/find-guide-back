<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Finder WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        body {
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 18px;
        }

        #guideForm {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            max-width: 300px; /* Added max-width for mobile-friendly layout */
        }

        #guideForm label {
            display: flex;
            align-items: center;
            margin-bottom: 8px; /* Added margin-bottom for spacing between labels */
        }

        #guideForm label span {
            flex: 1; /* Allow the label text to take up remaining space */
        }

        #guideForm input[type="date"],
        #guideForm select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px; /* Rounded corners for input fields */
            margin-bottom: 16px; /* Increased margin-bottom for spacing between input fields */
            width: 100%; /* Added width: 100% for full-width on mobile */
            box-sizing: border-box; /* Include padding and border in the element's total width */
        }

        #guideForm input[type="checkbox"] {
            margin-bottom: 16px; /* Increased margin-bottom for spacing between input fields */
        }

        #results {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>

<body>
<div id="guideForm">

    <label for="fromDate">
        <span>From Date:</span>
        <input type="date" id="fromDate" name="fromDate">
    </label>

    <label for="toDate">
        <span>To Date:</span>
        <input type="date" id="toDate" name="toDate">
    </label>

    <label for="language">
        <span>Language:</span>
        <select id="language" name="language">
            <option value="ENGLISH">ENGLISH</option>
            <option value="RUSSIAN">RUSSIAN</option>
            <option value="SPANISH">SPANISH</option>
            <!-- Add more language options as needed -->
        </select>
    </label>

    <label for="region">
        <span>Region:</span>
        <select id="region" name="region">
            <option value="UZBEKISTAN">UZBEKISTAN</option>
            <option value="TASHKENT">TASHKENT</option>
            <option value="SAMARKAND">SAMARKAND</option>
            <!-- Add more region options as needed -->
        </select>
    </label>

    <label for="hasCar">
        <input type="checkbox" id="hasCar" name="hasCar">
        <span>Has Car</span>
    </label>

</div>

<div id="results">
    <p id="guideName"></p>
    <p id="guideLanguage"></p>
    <p id="guideRegion"></p>
    <p id="guideCar"></p>
</div>

<script>
    let fromDate = document.getElementById("fromDate");
    let toDate = document.getElementById("toDate");
    let language = document.getElementById("language");
    let region = document.getElementById("region");
    let hasCar = document.getElementById("hasCar");

    let tg = window.Telegram.WebApp;
    // tg.expand();

    tg.MainButton.text = "Changed Text"; //изменяем текст кнопки
    tg.MainButton.color = "#143F6B"; //изменяем цвет бэкграунда кнопки
    tg.MainButton.enable()
    tg.MainButton.show()

    Telegram.WebApp.onEvent('mainButtonClicked', function(){
        sendData();
    });

    function sendData() {
        let initDataURLSP = new URLSearchParams(tg.initData);
        let userStr = initDataURLSP.get('user');
        let user = JSON.parse(userStr);

        // Create an object with the search parameters
        let searchParams = {
            // user_id: userId.value,
            telegram_id: user.id,
            from_date: fromDate.value,
            to_date: toDate.value,
            language: language.value,
            region: region.value,
            has_car: hasCar.checked,
            comment: user
        };

        fetch('https://still-beyond-67512-6a27447420c3.herokuapp.com/guide-search', {
        // fetch('http://127.0.0.1:8280/guide-search/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(searchParams)
        })
            .then(response => response.json())
            .then(data => {
                console.log('Response: ', data);
                tg.showPopup(data)
            })
            .catch(error => {
                console.error('Error: ', error);
                tg.showAlert("Error: ", error)
            });
    }
</script>
</body>
</html>

