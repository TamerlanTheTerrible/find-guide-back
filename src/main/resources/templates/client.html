<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Finder WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        body {
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 18px;
        }

        .hint {
            color: var(--tg-theme-hint-color);
        }

        .link {
            color: var(--tg-theme-link-color);
        }

        .button {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            font-size: 18px;
        }

        .button:not(:last-child) {
            margin-bottom: 20px;
        }

        #guideForm {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        #results {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>

<body>
<div id="guideForm">
    <label for="fromDate">From Date:</label>
    <input type="date" id="fromDate" name="fromDate">

    <label for="toDate">To Date:</label>
    <input type="date" id="toDate" name="toDate">

    <label for="language">Language:</label>
    <select id="language" name="language">
        <option value="ENGLISH">ENGLISH</option>
        <option value="RUSSIAN">RUSSIAN</option>
        <option value="SPANISH">SPANISH</option>
        <!-- Add more language options as needed -->
    </select>

    <label for="region">Region:</label>
    <select id="region" name="region">
        <option value="UZBEKISTAN">UZBEKISTAN</option>
        <option value="TASHKENT">TASHKENT</option>
        <option value="SAMARKAND">SAMARKAND</option>
        <!-- Add more region options as needed -->
    </select>

    <label for="hasCar">Has Car:</label>
    <input type="checkbox" id="hasCar" name="hasCar">

    <button id="searchButton" class="button">Search</button>
</div>

<div id="results">
    <p id="guideName"></p>
    <p id="guideLanguage"></p>
    <p id="guideRegion"></p>
    <p id="guideCar"></p>
</div>

<script>
    let fromDate = document.getElementById("fromDate").value;
    let toDate = document.getElementById("toDate").value;
    let language = document.getElementById("language").value;
    let region = document.getElementById("region").value;
    let hasCar = document.getElementById("hasCar").checked;

    let searchButton = document.getElementById("searchButton");
    let guideName = document.getElementById("guideName");
    let guideLanguage = document.getElementById("guideLanguage");
    let guideRegion = document.getElementById("guideRegion");
    let guideCar = document.getElementById("guideCar");

    let tg = window.Telegram.WebApp;
    tg.expand();

    tg.MainButton.text = "Changed Text"; //изменяем текст кнопки
    tg.MainButton.color = "#143F6B"; //изменяем цвет бэкграунда кнопки
    tg.MainButton.enable()
    tg.MainButton.show()

    Telegram.WebApp.onEvent('mainButtonClicked', function(){
        sendData();
    });

    searchButton.addEventListener('click', function () {
        sendData();
    });

    function sendData() {
        // Create an object with the search parameters
        let searchParams = {
            from_date: fromDate,
            to_date: toDate,
            language: language,
            region: region,
            has_car: hasCar
        };

        // Convert the object to a JSON string
        guideRegion.innerText = searchParams;
        let searchData = JSON.stringify(searchParams);
        guideLanguage.innerText = searchData

        fetch('https://still-beyond-67512-6a27447420c3.herokuapp.com/guide-search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(searchData)
        })
            .then(response => {
                if (response.ok) {
                    console.log('Data sent successfully to the backend');
                    guideName.innerText = "Success!";
                    // Handle the response from your backend if needed
                } else {
                    console.error('Failed to send data to the backend');
                    guideName.innerText = "Error";
                }
            })
            .catch(error => {
                console.error('Error:', error);
                guideName.innerText = "serious error";
            });

        // Close the WebApp after sending the data
        // tg.close();
    }




    // searchButton.addEventListener('click', function () {
    //         let fromDate = document.getElementById("fromDate").value;
    //         let toDate = document.getElementById("toDate").value;
    //         let language = document.getElementById("language").value;
    //         let region = document.getElementById("region").value;
    //         let hasCar = document.getElementById("hasCar").checked;
    //
    //         // Perform the guide search based on the parameters
    //         // Replace the following code with your actual guide search implementation
    //         let guide = findGuide(fromDate, toDate, language, region, hasCar);
    //
    //         if (guide) {
    //             guideName.innerText = "Guide Name: " + guide.name;
    //             guideLanguage.innerText = "Language: " + guide.language;
    //             guideRegion.innerText = "Region: " + guide.region;
    //             guideCar.innerText = "Has Car: " + (guide.hasCar ? "Yes" : "No");
    //         } else {
    //             guideName.innerText = "No guide found.";
    //             guideLanguage.innerText = "";
    //             guideRegion.innerText = "";
    //             guideCar.innerText = "";
    //         }
    //     });
    //
    //     function findGuide(fromDate, toDate, language, region, hasCar) {
    //         // Implement your guide search logic here
    //         // Return the found guide or null if no guide matches the parameters
    //         // You can replace this function with your actual guide search implementation
    //         // Example code:
    //         let guides = [
    //             {
    //                 name: "John Doe",
    //                 language: "English",
    //                 region: "North",
    //                 hasCar: true
    //             },
    //             {
    //                 name: "Jane Smith",
    //                 language: "French",
    //                 region: "South",
    //                 hasCar: false
    //             },
    //             // Add more guide objects as needed
    //         ];
    //
    //         for (let i = 0; i < guides.length; i++) {
    //             let guide = guides[i];
    //             // Check if the guide matches the parameters
    //             if (
    //                 guide.language === language &&
    //                 guide.region === region &&
    //                 guide.hasCar === hasCar
    //             ) {
    //                 return guide;
    //             }
    //         }
    //
    //         return null; // No guide found
    //     }
</script>
</body>
</html>

